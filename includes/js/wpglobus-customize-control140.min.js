jQuery(document).ready(function(e){"use strict";var t={languages:{},index:0,length:0,controlInstances:{},controlWidgets:{},instancesKeep:!1,widgetKeep:!1,action:!1,selectorHtml:'<span style="margin-left:5px;" class="wpglobus-icon-globe"></span><span style="font-weight:bold;">{{language}}</span>',init:function(n){e.each(WPGlobusCoreData.enabled_languages,function(e,n){t.languages[e]=n,t.length=e}),t.addLanguageSelector(),t.setTitle(),t.setControlInstances(),t.attachListeners()},ctrlMenuItemsCallback:function(e,t){},ctrlWidgetCallback:function(n,o){if(t.action=!1,"undefined"==typeof t.controlWidgets[n].element){"undefined"==typeof o&&(o=wp.customize.control.instance(n)),t.controlWidgets[n].element={},t.controlWidgets[n].control=o,t.controlWidgets[n].inWidgetTitle=o.container.find(".in-widget-title");var s=o.container.find("input[type=submit]");0!=s.length&&(s.css({display:"block"}),s.attr("data-widget",n),t.controlWidgets[n].submit=s,t.attachWidgetListeners(t.controlWidgets[n])),o.liveUpdateMode=!1,"undefined"==typeof o.setting().title?t.controlWidgets[n].inWidgetTitle.text(""):t.controlWidgets[n].inWidgetTitle.text(": "+WPGlobusCore.TextFilter(o.setting().title,WPGlobusCustomize.languageAdmin)),e.each(WPGlobusCustomize.elementSelector,function(s,l){var i=o.container.find(l);0!=i.length&&e.each(i,function(s,a){var u=e(i[s]);"undefined"==typeof t.controlWidgets[n].element[a.id]&&(t.controlWidgets[n].element[a.id]={}),u.addClass("wpglobus-customize-widget-control"),u.attr("data-widget",n),t.controlWidgets[n].element[a.id].element=u,t.controlWidgets[n].element[a.id].setting=o.setting(),t.controlWidgets[n].element[a.id].selector=l,t.controlWidgets[n].element[a.id].value=a.defaultValue,u.val(WPGlobusCore.TextFilter(a.defaultValue,WPGlobusCoreData.language,"RETURN_EMPTY"))})}),e(document).triggerHandler("wpglobus_cusomize_control_added_widget",[n])}},ctrlCallback:function(n,o,s){var l=!1;if(e.each(WPGlobusCustomize.disabledSettingMask,function(e,t){return o.indexOf(t)>=0?(l=!0,!1):void 0}),!l){var i=wp.customize.control.instance(o);return o.indexOf("widget")>=0?("undefined"==typeof t.controlWidgets[o]&&(t.controlWidgets[o]={},t.action&&t.ctrlWidgetCallback(o,i)),t.controlWidgets[o].parent=i.selector,!1):void("undefined"==typeof t.controlInstances[o]&&e.each(WPGlobusCustomize.elementSelector,function(n,s){var l=i.container.find(s);0!=l.length&&(t.controlInstances[o]={},t.controlInstances[o].element=l,t.controlInstances[o].setting=i.setting(),t.controlInstances[o].selector=s,t.controlInstances[o].type="",e.each(WPGlobusCustomize.setLinkBy,function(e,n){o.indexOf(n)>=0&&(t.controlInstances[o].type="link",""==t.controlInstances[o].setting&&(t.controlInstances[o].setting=l[0].defaultValue),l.addClass("wpglobus-control-link"))}),""===t.controlInstances[o].type&&("textarea"==s?t.controlInstances[o].type="textarea":t.controlInstances[o].type="text"),l.val(WPGlobusCore.TextFilter(t.controlInstances[o].setting,WPGlobusCoreData.language,"RETURN_EMPTY")),l.addClass("wpglobus-customize-control"),l.attr("data-wpglobus-customize-control",l.parents("li").attr("id").replace("customize-control-","")),"link"==t.controlInstances[o].type&&(t.controlInstances[o].setting=t.convertString(l[0].defaultValue)))}))}},setControlInstances:function(){wp.customize.control.each(t.ctrlCallback)},setTitle:function(){e(WPGlobusCoreData.customize.info.element).html(WPGlobusCoreData.customize.info.html)},convertString:function(t){if("undefined"==typeof t)return t;var n=[],o=WPGlobusCore.getTranslations(t),s=0,l=!0;return e.each(o,function(e,t){""==t?n[s]="null":(l=!1,n[s]=t),s++}),l?"":n.join("|||")},getTranslations:function(t){var n={},o=t.split("|||");return e.each(WPGlobusCoreData.enabled_languages,function(e,t){n[t]="undefined"===o[e]||"null"===o[e]?"":o[e]}),n},getString:function(n,o,s){if("undefined"==typeof n)return n;"undefined"==typeof o&&(o=""),"undefined"==typeof s&&(s=WPGlobusCoreData.language);var l=t.getTranslations(n),i=[],a=0;return e.each(l,function(e,t){e==s?i[a]=o:i[a]=""==t?"null":t,a++}),i=i.join("|||")},addLanguageSelector:function(){e('<a style="margin-left:48px;" class="customize-controls-close wpglobus-customize-selector"><span class="wpglobus-globe"></span></a>').insertAfter(".customize-controls-preview-toggle"),e(".wpglobus-customize-selector").html(t.selectorHtml.replace("{{language}}",WPGlobusCoreData.language)),e(document).on("click",".wpglobus-customize-selector",function(n){t.index>t.length-1?t.index=0:t.index++,WPGlobusCoreData.language=t.languages[t.index],e(this).html(t.selectorHtml.replace("{{language}}",WPGlobusCoreData.language)),e(document).triggerHandler("wpglobus_cusomize_control_language",[WPGlobusCoreData.language]),e(".wpglobus-customize-control").each(function(n,o){var s=e(o),l=s.data("customize-setting-link");if("undefined"!=typeof WPGlobusCustomize.controlInstances[l]||(l=s.data("wpglobus-customize-control"),"undefined"!=typeof WPGlobusCustomize.controlInstances[l]))if(s.hasClass("wpglobus-control-link")){var i=t.getTranslations(WPGlobusCustomize.controlInstances[l].setting);s.val(i[WPGlobusCoreData.language])}else s.val(WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[l].setting,WPGlobusCoreData.language,"RETURN_EMPTY"))}),e(".wpglobus-customize-widget-control").each(function(t,n){var o=e(n),s=o.data("widget");o.val(WPGlobusCore.TextFilter(WPGlobusCustomize.controlWidgets[s].element[o.attr("id")].value,WPGlobusCoreData.language,"RETURN_EMPTY"))})})},updateElements:function(n){"undefined"==typeof n&&(n=!0),e.each(WPGlobusCustomize.controlInstances,function(e,o){var s=wp.customize.control.instance(e);if("link"==o.type){var l=t.getTranslations(WPGlobusCustomize.controlInstances[e].setting);n?(s.setting.set(l[WPGlobusCoreData.language]),o.element.val(s.setting())):o.element.val(l[WPGlobusCoreData.language])}else n?(s.setting.set(WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[e].setting,WPGlobusCoreData.language,"RETURN_EMPTY")),o.element.val(s.setting())):o.element.val(WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[e].setting,WPGlobusCoreData.language,"RETURN_EMPTY"))})},onSubmitEvents:function(n){"mouseenter"==n.type?e.each(t.controlWidgets[e(this).data("widget")].element,function(t,n){e("#"+t).val(n.value)}):"mouseleave"==n.type?t.widgetKeep||e.each(t.controlWidgets[e(this).data("widget")].element,function(t,n){e("#"+t).val(WPGlobusCore.TextFilter(n.value,WPGlobusCoreData.language,"RETURN_EMPTY"))}):"click"==n.type&&(t.widgetKeep=!0)},attachWidgetListeners:function(n){"undefined"!=typeof n.submit[0].id&&e(document).on("mouseenter","#"+n.submit[0].id,t.onSubmitEvents).on("mouseleave","#"+n.submit[0].id,t.onSubmitEvents).on("click","#"+n.submit[0].id,t.onSubmitEvents)},attachListeners:function(){e(".wpglobus-customize-control").on("keyup",function(n){var o=e(this),s=o.data("customize-setting-link");("undefined"!=typeof WPGlobusCustomize.controlInstances[s]||(s=o.data("wpglobus-customize-control"),"undefined"!=typeof WPGlobusCustomize.controlInstances[s]))&&("link"==WPGlobusCustomize.controlInstances[s].type?WPGlobusCustomize.controlInstances[s].setting=t.getString(WPGlobusCustomize.controlInstances[s].setting,o.val(),WPGlobusCoreData.language):WPGlobusCustomize.controlInstances[s].setting=WPGlobusCore.getString(WPGlobusCustomize.controlInstances[s].setting,o.val(),WPGlobusCoreData.language))}),e(document).on("keyup",".wpglobus-customize-widget-control",function(t){var n=e(this),o=n.data("widget");"undefined"!=typeof WPGlobusCustomize.controlWidgets[o]&&(WPGlobusCustomize.controlWidgets[o].element[n.attr("id")].value=WPGlobusCore.getString(WPGlobusCustomize.controlWidgets[o].element[n.attr("id")].value,n.val(),WPGlobusCoreData.language))}),e("#save").on("mouseenter",function(t){e.each(WPGlobusCustomize.controlInstances,function(e,t){var n=wp.customize.control.instance(e);n.setting.set(t.setting),t.element.val(n.setting())})}).on("mouseleave",function(e){t.instancesKeep||t.updateElements()}).on("click",function(e){t.instancesKeep=!0}),e(document).on("ajaxComplete",function(n,o){"undefined"!=typeof o.responseText&&('{"success":true,"data":[]}'==o.responseText?t.updateElements(!1):(o.responseText.indexOf("WP_CUSTOMIZER_SIGNATURE")>=0&&(t.action="customizerAjaxComplete",t.setControlInstances()),e.each(WPGlobusCustomize.controlWidgets,function(n,s){var l=n.replace("_","-");return o.responseText.indexOf(l)>=0?(s.submit.css({display:"block"}),s.control.liveUpdateMode=!1,e.each(s.element,function(t,n){e("#"+t).val(WPGlobusCore.TextFilter(n.value,WPGlobusCoreData.language,"RETURN_EMPTY"))}),s.inWidgetTitle.text(": "+WPGlobusCore.TextFilter(s.control.setting().title,WPGlobusCustomize.languageAdmin)),t.widgetKeep=!1,!1):void 0})))}),e(document).on("click",".widget-title, .widget-title-action",function(n){var o=e(this).parents(".customize-control-widget_form").attr("id");e.each(t.controlWidgets,function(e,n){return"#"+o==n.parent?(t.ctrlWidgetCallback(e),!1):void 0})})}};WPGlobusCustomize=e.extend({},WPGlobusCustomize,t),WPGlobusCustomize.init()});